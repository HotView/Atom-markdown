## CGI
#### 通用
是一个显著特征。虽然我们听说过Java的Servlet，Python的WSGI。但其实Java、Python都是支持CGI的，不仅如此，其他我们所熟知的语言大都也都支持。理论上来说，所有支持标准输出，支持获取环境变量的编程语言都能用来编写CGI程序。

在HTML诞生之后，随着网络规模的发展，动态网站成为人们的主要诉求。彼时，CGI应运而生。第一个版本的CGI由Perl语言编写的脚本，因此通常称之为“CGI脚本”。直至今日，把CGI一词丢入谷歌的搜索框，搜到的一大把都是Perl相关的内容。
####  2. Gateway

**网关**，不用好奇，不用疑惑。随便打开一本HTTP的书，都会提到网关的概念。通常意识中，网关一词更多的是硬件层面的概念，但其实与CGI的网关二字之含义也是不谋而合的。称CGI为软件网关也不为过。

网关，更形象的叫法是“**协议翻译机**”。通常与网关输入输出两端通信使用的是不同的协议。即一方是HTTP协议，另一方可能是其他协议，比如企业内部的自定义协议。CGI程序既是如此。
#### ## 3. Interface

_**Interface**：Come On。又是一个被国人翻译烂掉的词汇。API（应用程序接口）的I是它，被译作“接口”。UI（用户界面）的I也是它，被译作“界面”。实际他们是同样的意思。我更喜欢“接口”一词。_

#### 3.1 接口协议

**接口**，确切而言是“接口协议”，熟悉网络的同学们，肯定都明白“**协议**”是什么。所谓协议，既是通信双方或多方都共识并遵守的一套规则。就像红灯行，绿灯停，上下车道靠右行。只有全国人民都遵守这个规则，交通才不会出什么乱子。实际上规定绿灯停，红灯停或者上下车道靠左行可不可以呢？当然可以，英国日本都是靠左行的，关键是全国人民的认知要一致，这个**共识**很重要。

举几个栗子?：TCP/IP这类二进制协议，协议内容的描述是某某字节是干嘛滴，其取值范围是什么，不同取值又是什么含义。HTTP协议是字符协议，这类协议内容的描述就是第一行是啥，第二行是啥……，应该出现啥单词，表示啥意思。

其实不管是TCP/IP或是HTTP，都可以统称为“网络协议”，粗浅一点理解就是“**描述报文内容详细语义的协议**”。而“接口协议”却不然，他不会定义哪些字节该写什么，也不会定义字符的内容规范。CGI其实是构架在HTTP协议之上的。它描述的是**另一个维度的共识标准**
#### 3.2 输入，输出
回顾上一节的图。Web服务器在接收到用户浏览器的HTTP请求，比如请求如下URL：

```text
http://guodongxiaren.me/cgi-bin/helloworld.cgi
```

此时在Web服务器调用helloworld.cgi之前，会把各类HTTP请求中的信息以**环境变量**的方式写入OS。CGI程序本质是OS上一个普通的可执行程序，它通过语言本身库函数来获取环境变量，从而获得数据输入。

除环境变量外，另外一个CGI程序获取数据的方式就是**标准输入（stdin）**。如post请求一个CGI的URL，那么POST的数据，CGI是通过标准输入来获取到的。
==而CGI如何构造出数据（比如HTML页面）返回给浏览器呢？其实CGI本身只要向标准输出去写入数据即可。比如printf、cout，比如System.out.println，又比如print、echo等。因为Web服务器已经做了重定向，将标准输出重定向给Web服务器的与浏览器连接的socket。==

此时要注意的是，不要以为返回HTML页面，那么直接输出一段HTML代码就OK，注意。此时CGI的输出承担的是HTTP协议的响应部分，因此HTTP响应报头也要自己标准输出出来。比如：

```cpp
cout<<"Content-Type:text/html\n\n"<<endl;  
```
注意最后要有两个换行符啊。不要问为什么。因为HTTP协议本身就是一个字符协议。它需要通过一个空行来区分哪里是报头，哪里是实体。在两个换行符（即一个空行）之后就可以愉快的输出HTML（即实体部分）了。熟悉PHP的同学，肯定echo过HTML代码，没错，这很像。
## WSGI
早期的HTTP编程中，许多Python服务器都会被编写为简单的CGI脚本。每次收到请求就会触发CGI脚本。
服务器对HTTP请求进行分割，将相应的参数以环境变量的形式传入CGI脚本。

CGI的工作方式，从Web服务器的角度看，是在特定的位置定义了可以运行CGI程序。当收到一个匹配URL的请求，相应的程序就会被调用，并将客户端发送的数据作为输入。程序的输出会由Web服务器收集，并加上合适的档头，再发送回客户端。

一般每次的CGI请求都需要新生成一个程序的副本来运行，这样大的工作量会很快将服务器压垮，因此一些更有效的技术像mod_perl，可以让脚本解释器直接作为模块集成在Web服务器（例如：Apache）中，这样就能避免重复加载和初始化解释器。

为了解决移植性差的问题，提出了Web服务器网关接口（WSGI）
在Web服务器网关接口（WSGI）是一个简单的调用约定:Web服务器将请求转发到Web应用程序或框架写在Python编程语言

WSGI有两个方面：
- 在服务器 /网关端。这通常是完整的Web服务器，例如Apache或Nginx，或者是可以与web服务器通信的轻量级应用程序服务器，例如flup。
- 应用程序/框架方面。这是Python可调用的，由Python程序或框架提供。

在服务器和应用程序之间，可能存在一个或多个WSGI 中间件组件，它们实现API的两个方面，通常是Python代码。

WSGI没有指定应该如何启动Python解释器，也不指定应该如何加载或配置应用程序对象，并且不同的框架和Web服务器以不同的方式实现这一点。
## 不使用Web框架编写WSGI可调用对象
Web框架的基本任务是负责URL转发。


> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE4NjMxNjc1NTBdfQ==
-->